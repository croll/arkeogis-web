<div class="step2" layout layout-md="column" layout-sm="column" flex>
    <md-card layout layout-md="column" layout-sm="column" flex="50" flex-md="100" flex-sm="100">
        <div flex="40">
            <nvd3 class="nvd3Chart" options="nvd3Options" data="nvd3Datas"></nvd3>
        </div>
        <div class="legend" layout-padding flex layout-align="start center">
            <div class="l" ng-hide="nbSitesOK < 0">
                <div>Nombre de lignes traitées: <span class="b">{{nbLines}}</span>
                </div>
                <div class="help-block">
                    Hormis la première ligne.
                </div>
            </div>
            <div class="l" ng-hide="nbSitesOK < 0">
                <div>Nombre de sites détectés dans le fichier: <span class="b">{{nbSites}}</span>
                </div>
                <div class="help-block">
                    Nombre de SITE_ID_SOURCE différents.
                </div>
            </div>
            <div class="l" ng-hide="nbSitesOK < 0">
                <div>Nombre de sites valides: <span class="b ok">{{nbSitesOK}}</span>
                </div>
                <div class="help-block">
                    Importables dans ArkeoGIS
                </div>
            </div>
            <div class="l" ng-hide="nbSitesOK < 0">
                <div>Nombre de sites en erreur: <span class="b nok">{{nbSitesNOK}}</span>
                </div>
                <div class="help-block">
                    Qui ont au moins une informations invalide
                </div>
            </div>
            <div class="l">
                <div>Nombre total d'erreurs: <span class="b">{{nbErrors}}</span>
                </div>
                <div class="help-block">
                    Liste détaillée ci-dessous.
                </div>
            </div>
        </div>
    </md-card>
    <div class="actions" layout="column" flex>
        <md-card flex ng-hide="nbErrors > 0">
            <div>
                <h3>Importation réussie</h3>
                <div layout-padding>
                    <a ng-click="goToStep3()">Étape suivante</a>
                </div>
                <div class="help-block" hide-sm>
                    Accéder au formulaire de publication
                </div>
            </div>
        </md-card>
        <md-card flex ng-hide="nbErrors == 0">
            <h3>Importer un autre fichier</h3>
            <div layout layout-sm="column" layout-padding>
                <md-button class="md-primary md-raised" ngf-select="uploadCSV(file)" ng-model="file"
                name="file" ngf-pattern="'.csv,.txt'" accept=".csv,.txt" ngf-max-size="100MB">Choisir un fichier à importer</md-button>
            </div>
            <md-progress-linear md-mode="determinate" value="{{uploadProgress}}" md-buffer-value="100"
            ng-hide="!file"></md-progress-linear>
            <div class="help-block" hide-sm>
                Effectuer une autre importation de la même base de données après correction des
                erreurs.
            </div>
        </md-card>
        <md-card flex>
            <h3>Modifier les options d'import</h3>
            <div layout-padding>
                <a ui-sref="import.step1">Revenir à l'étape précédente</a>
            </div>
            <div class="help-block" hide-sm>
                Modifier les informations de la base, les options d'import, et renvoyer un nouveau
                fichier.
            </div>
        </md-card>
    </div>
</div>

<div ng-hide="nbErrors == 0">
    <md-data-table-toolbar ng-hide="selected.length || filter.show">
        <h2 class="md-title">Report</h2>
        <div flex></div>
        <md-button class="md-icon-button" ng-click="filter.show = true">
            <md-tooltip md-direction="left">
				Filtrer les résultats
            </md-tooltip>
            <i class="material-icons md-dark">filter_list</i>
        </md-button>
    </md-data-table-toolbar>

    <md-data-table-toolbar ng-show="filter.show && !selected.length">
        <i class="material-icons md-dark">search</i>
        <form flex name="filter.form">
            <input type="text" ng-model="query.filter" ng-model-options="filter.options" placeholder="search" style="margin-top: 22px">
			<div class="help-block" style="margin: 7px 0 0 0">
				Saisissez du texte pour filtrer les résultats. Toutes les colonnes sont prises en compte.
			</div>
        </form>
        <md-button class="md-icon-button" ng-click="removeFilter()">
            <i class="material-icons md-dark">close</i>
        </md-button>
    </md-data-table-toolbar>

    <md-data-table-container>
        <table md-data-table>
            <thead md-order="query.order" md-trigger="onOrderChange">
                <tr>
                    <th numeric name="Line" order-by="line"></th>
                    <th numeric name="Site code" order-by="siteCode"></th>
                    <th numeric name="Columns" order-by="columns"></th>
                    <th numeric name="Value" order-by="value"></th>
                    <th numeric name="Error Message" order-by="errMsg"></th>
                </tr>
            </thead>
            <tbody>
                <tr md-auto-select ng-repeat="error in importErrors.data | filter:query.filter | orderBy: order | limitTo: query.limit : (query.page - 1) * query.limit">
                    <td>{{error.line}}</td>
                    <td>
                        {{error.siteCode}}
                    </td>
                    <td>{{error.columns|join}}</td>
                    <td>{{error.value}}</td>
                    <td>{{error.errMsg}}</td>
                </tr>
            </tbody>
        </table>
    </md-data-table-container>

    <md-data-table-pagination md-limit="query.limit" md-page="query.page" md-total="{{importErrors.total}}"
    md-row-select="query.numRows"></md-data-table-pagination>
